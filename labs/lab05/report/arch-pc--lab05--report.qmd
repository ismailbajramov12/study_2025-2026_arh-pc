---
## Author
author:
  name: Байрамов Исмаил Мухандис оглы
  email: 1032253514@pfur.ru

## Title
title: "Отчёта по лабораторной работе №5"
number-sections: true
license: "CC BY"
---

# Цель работы

Приобретение практических навыков работы в Midnight Commander. Освоение инструкций языка ассемблера mov и int.

# Теоретическое введение

## Основы работы с Midnight Commander

Midnight Commander (или просто *mc*) — это файловый менеджер, позволяющий просматривать структуру каталогов и выполнять основные операции по управлению файловой системой. Он делает работу с файлами более удобной и наглядной.

Для запуска Midnight Commander необходимо ввести в командной строке:

```
mc
```
и нажать Enter.

В Midnight Commander используются функциональные клавиши **F1 — F10**, к которым привязаны часто выполняемые операции:

| Клавиша | Действие |
|--------|----------|
| F1     | Вызов контекстной подсказки |
| F2     | Вызов пользовательского меню |
| F3     | Просмотр файла, на который указывает курсор |
| F4     | Встроенный редактор |
| F5     | Копирование файла или группы файлов |
| F6     | Перемещение файла или группы файлов |
| F7     | Создание подкаталога |
| F8     | Удаление файла или каталога |
| F9     | Вызов основного меню программы |
| F10    | Выход из программы |

Дополнительные полезные сочетания клавиш:

- **Tab** — переключение между панелями.
- **↑ / ↓** — перемещение по файлам.
- **Enter** — вход в каталог или открытие файла.
- **Ctrl+u** — поменять панели местами.
- **Ctrl+o** — скрыть/показать панели, оставив доступ к командной строке.
- **Ctrl+x, d** — сравнение каталогов.

Дополнительную информацию можно получить по команде:

```
man mc
```

## Структура программы на языке ассемблера NASM

Программа NASM обычно состоит из трёх секций:

1. **SECTION .data** — инициированные данные.
2. **SECTION .bss** — неинициализированные данные.
3. **SECTION .text** — код программы.

Пример общей структуры:

```
SECTION .data
    ; объявление данных

SECTION .bss
    ; резервирование памяти

SECTION .text
    GLOBAL _start
_start:
    ; код программы

    mov eax,1
    mov ebx,0
    int 80h
```

### Директивы для объявления данных

Для инициированных данных используются директивы:

- DB — 1 байт
- DW — 2 байта
- DD — 4 байта
- DQ — 8 байт
- DT — 10 байт

Примеры:

```
a db 10011001b
b db '!'
c db "Hello"
d dd -345d
h dd 0f1ah
```

Для неинициализированных данных используются директивы `resb`, `resw`, `resd`:

```
string resb 20
count  resw 256
x      resd 1
```

## Элементы программирования

### Инструкция mov

Инструкция `mov` копирует данные:

```
mov dst, src
```

Примеры:

```
mov eax, ebx
mov cx, [eax]
mov rez, ebx
mov eax, 403045h
mov byte [rez], 0
```

Важно:

- Нельзя копировать память в память одной инструкцией.
- Размеры операндов должны совпадать.

### Инструкция int

Инструкция `int` вызывает программное прерывание:

```
int n
```

Для Linux используется:

```
int 80h
```

Перед вызовом ядро ожидает:

- в `eax` — номер системного вызова;
- в `ebx`, `ecx`, `edx` — параметры.

### Системные вызовы для диалога

#### Вывод строки — write

```
mov eax, 4
mov ebx, 1
mov ecx, msg
mov edx, length
int 80h
```

#### Ввод строки — read

```
mov eax, 3
mov ebx, 0
mov ecx, buf
mov edx, size
int 80h
```

#### Завершение программы — exit

```
mov eax, 1
mov ebx, 0
int 80h
```

---

# Выполнение лабораторной работы

1. Откроем Midnight Commander с помощью команды `mc` (рис. @fig-001).

![Окно Midnight Commander](image/1.png){#fig-001 width=70%}

2.  С помощью клавиш **↑**, **↓** и **Enter** перейдем в каталог `~/work/arch-pc`, созданный при выполнении предыдущей лабораторной работы.

3. Создадим папку `lab05`, используя функцию создания каталога (рис. @fig-003).

![Окно Midnight Commander. Создание каталога](image/3.png){#fig-003 width=70%}

4. Пользуясь строкой ввода и командой touch создадим файл lab5-1.asm (рис. @fig-004).

![Окно Midnight Commander. Создание файла](image/4.png){#fig-004 width=70%}

5. С помощью функциональной клавиши **F4** откроем файл `lab5-1.asm` для редактирования во встроенном редакторе. Как правило в качестве встроенного редактора Midnight Commander используется редакторы nano или mcedit.

6. Введем текст программы из листинга 5.1, сохраним изменения и закроем файл (рис. @fig-006).

![Окно Midnight Commander. Файл после изменения](image/6.png){#fig-006 width=70%}

7. С помощью функциональной клавиши **F3** откроем файл l`ab5-1.asm` для просмотра.

8. Оттранслируем текст программы `lab5-1.asm` в объектный файл. Выполним компоновку объектного файла и запустим получившийся исполняемый файл. Программа выводит строку 'Введите строку:' и ожидает ввода с клавиатуры. На запрос введем ФИО (рис. @fig-008).

![Терминал. Работа программы](image/8.png){#fig-008 width=70%}

9. Скачаем файл `in_out.asm` со страницы курса в ТУИС.

10. Подключаемый файл `in_out.asm` должен лежать в том же каталоге, что и файл с программой, в которой он используется. В одной из панелей `mc` откроем каталог с файлом `lab5-1.asm`. В другой панели каталог со скачанным файлом `in_out.asm`. Скопируем файл `in_out.asm` в каталог с файлом `lab5-1.asm` с помощью функциональной клавиши **F5** (рис. @fig-010).

![Окно Midnight Commander. Копирование файла](image/10.png){#fig-010 width=70%}

11. С помощью функциональной клавиши **F6** создадим копию файла `lab5-1.asm` с именем `lab5-2.asm`. Выделим файл `lab5-1.asm`, нажмем клавишу **F6** , введем имя файла `lab5-2.asm` и нажмем клавишу **Enter** (рис. @fig-011).

![Окно Midnight Commander. Создание копии файла](image/11.png){#fig-011 width=70%}

12. Исправим текст программы в файле `lab5-2.asm` с использование подпрограмм из внешнего файла `in_out.asm` (используем подпрограммы sprintLF, sread и quit) в соответствии с листингом 5.2. Создадим исполняемый файл и проверим его работу (рис. @fig-012).

![Окно Midnight Commander. Редактирование программы](image/12_1.png){#fig-012 width=70%}

![Терминал. Работа программы](image/12_2.png){#fig-013 width=70%}

13. В файле `lab5-2.asm` заменим подпрограмму sprintLF на sprint. Создадим исполняемый файл и проверим его работу (рис. @fig-014).

![Окно nano. Редактирование программы](image/13_1.png){#fig-014 width=70%}

![Терминал. Работа программы](image/13_2.png){#fig-015 width=70%}

---

# Выполнение самостоятельной работы


1. Создадим копию файла `lab5-1.asm` (рис. @fig-016). Внесем изменения в программу (без использования внешнего файла `in_out.asm`), так чтобы она работала по следующему алгоритму:

   - вывести приглашение типа «Введите строку:»;
   - ввести строку с клавиатуры;
   - вывести введённую строку на экран.

![Окно Midnight Commander. Создана копия файла](image/s1_2.png){#fig-016 width=70%}

![Окно MС edit. Изменение программы](image/s1_2.png){#fig-017 width=70%}

2. Получим исполняемый файл и проверим его работу. На приглашение ввести строку введем свою фамилию (рис. @fig-018).

![Терминал. Работа программы](image/s2.png){#fig-018 width=70%}

3. Создадим копию файла `lab5-2.asm` (рис. @fig-019). Исправим текст программы с использованием подпрограмм из внешнего файла `in_out.asm`, так чтобы она работала по следующему алгоритму:

   - вывести приглашение типа «Введите строку:»;
   - ввести строку с клавиатуры;
   - вывести введённую строку на экран.

![Окно MС edit. Изменение программы](image/s3.png){#fig-019 width=70%}

4. Создадим исполняемый файл и проверим его работу (рис. @fig-020)

![Терминал. Работа программы](image/s4.png){#fig-020 width=70%}

# Выводы

В ходе выполнения лабораторной работы были освоены основные приёмы работы с файловым менеджером Midnight Commander, получены практические навыки создания, редактирования и управления файлами в командной среде Linux. Кроме того, был изучен базовый синтаксис языка ассемблера NASM, структура программы, правила объявления данных и применение системных вызовов mov и int.

