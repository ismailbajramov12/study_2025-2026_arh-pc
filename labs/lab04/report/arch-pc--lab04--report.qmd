---
## Author
author:
  name: Байрамов Исмаил Мухандис оглы
  email: 1032253514@pfur.ru

## Title
title: "Отчёта по лабораторной работе №4"
license: "CC BY"
---

# Цель работы

Освоение процедуры компиляции и сборки программ, написанных на ассемблере NASM.

# Задание

Здесь приводится описание задания в соответствии с рекомендациями методического пособия и выданным вариантом.

# Теоретическое введение

## 4.2. Теоретическое введение

### 4.2.1. Основные принципы работы компьютера

Основными функциональными элементами любой электронной вычислительной машины (ЭВМ) являются центральный процессор, память и периферийные устройства.

Взаимодействие этих устройств осуществляется через общую шину, к которой они подключены. Физически шина представляет собой большое количество проводников, соединяющих устройства друг с другом. В современных компьютерах проводники выполнены в виде электропроводящих дорожек на материнской (системной) плате.

Основной задачей процессора является обработка информации, а также организация координации всех узлов компьютера. В состав **центрального процессора (ЦП)** входят следующие устройства:

- **арифметико-логическое устройство (АЛУ)** — выполняет логические и арифметические действия, необходимые для обработки информации, хранящейся в памяти;
- **устройство управления (УУ)** — обеспечивает управление и контроль всех устройств компьютера;
- **регистры** — сверхбыстрая оперативная память небольшого объёма, входящая в состав процессора, для временного хранения промежуточных результатов выполнения инструкций. Регистры процессора делятся на два типа: **регистры общего назначения** и **специальные регистры**.

Для того чтобы писать программы на ассемблере, необходимо знать, какие регистры процессора существуют и как можно их использовать. Большинство команд в программах, написанных на ассемблере, используют регистры в качестве операндов. Практически все команды представляют собой преобразование данных, хранящихся в регистрах процессора, например пересылка данных между регистрами или между регистрами и памятью, преобразование (арифметическое или логическое) данных, хранящихся в регистрах.

Доступ к регистрам осуществляется не по адресам, как к основной памяти, а по именам. Каждый регистр процессора архитектуры x86 имеет своё название, состоящее из 2 или 3 букв латинского алфавита.

Пример названий **регистров общего назначения**:

- RAX, RCX, RDX, RBX, RSI, RDI — 64-битные  
- EAX, ECX, EDX, EBX, ESI, EDI — 32-битные  
- AX, CX, DX, BX, SI, DI — 16-битные  
- AH, AL, CH, CL, DH, DL, BH, BL — 8-битные (половинки 16-битных регистров)

Например, **AH** (high AX) — старшие 8 бит регистра AX, **AL** (low AX) — младшие 8 бит регистра AX.

Таким образом, можно написать, например, такие команды (mov — команда пересылки данных):

```
mov ax, 1
mov eax, 1
```

Обе команды поместят в регистр AX число 1. Разница заключается в том, что вторая команда обнулит старшие разряды регистра EAX, то есть после её выполнения в регистре EAX будет число 1. А первая команда оставит старшие разряды EAX без изменений.

Другим важным узлом ЭВМ является **оперативное запоминающее устройство (ОЗУ)**.  
ОЗУ — это быстродействующее энергозависимое устройство, предназначенное для хранения программ и данных, с которыми процессор работает в текущий момент. ОЗУ состоит из одинаковых ячеек памяти, каждая из которых имеет свой номер — **адрес**.

В состав ЭВМ также входят **периферийные устройства**, которые можно разделить на:

- **устройства внешней памяти** — для долговременного хранения больших объёмов данных (жёсткие диски, SSD, магнитные ленты);
- **устройства ввода-вывода** — обеспечивают взаимодействие ЦП с внешней средой.

В основе вычислительного процесса ЭВМ лежит **принцип программного управления**.  
Это означает, что компьютер решает задачу как последовательность действий, записанных в виде программы. Программа состоит из машинных команд, которые указывают, какие операции и над какими данными необходимо выполнить.

**Код команды** делится на две части: **операционную** (код выполняемой операции) и **адресную** (адреса данных, участвующих в операции).

Каждая команда выполняется процессором в рамках **командного цикла**, включающего этапы:

1. Формирование адреса в памяти очередной команды  
2. Считывание кода команды и её дешифрация  
3. Выполнение команды  
4. Переход к следующей команде

---

### 4.2.2. Ассемблер и язык ассемблера

**Язык ассемблера** (assembly language, asm) — машинно-ориентированный язык низкого уровня.  
Он ближе к архитектуре ЭВМ, чем языки высокого уровня, и позволяет работать напрямую с аппаратными ресурсами.

Программы на ассемблере состоят из мнемокодов — символических обозначений машинных команд. Процессор, однако, не понимает мнемокоды, а только **машинный код** — последовательности нулей и единиц. Поэтому необходима **трансляция** — преобразование программы с языка ассемблера в машинный код, выполняемая специальной программой **Ассемблером**.

Каждая архитектура процессоров имеет свой набор ассемблеров, например:
- Для DOS/Windows: TASM, MASM, WASM  
- Для GNU/Linux: GAS (GNU Assembler)  
- Универсальные современные варианты: NASM (Netwide Assembler)

**NASM** использует Intel-синтаксис и поддерживает инструкции x86-64.  
Типичный формат команды в NASM:

```
[метка:] мнемокод [операнд [, операнд]] [; комментарий]
```

- **Мнемокод** — инструкция процессору.  
- **Операнды** — числа, данные, адреса регистров или памяти.  
- **Метка** — идентификатор, связанный с адресом команды.

Допустимые символы в метках: буквы, цифры, _, $, #, @, ~, ., ?  
Метка должна начинаться с буквы или символа _, а максимальная длина — 4095 символов.  

Ассемблер-программа также может содержать **директивы**, управляющие работой транслятора (например, определения данных). Директивы пишутся заглавными буквами.

---

### 4.2.3. Процесс создания и обработки программы на языке ассемблера

Процесс можно разделить на 4 шага:

1. **Набор текста** — написание программы в текстовом редакторе и сохранение в файл с расширением `.asm`.  
2. **Трансляция** — преобразование текста программы в **объектный код** с помощью ассемблера (например, `nasm`). Получается файл с расширением `.o`.  
3. **Компоновка (линковка)** — сборка объектного кода в исполняемый файл (обычно без расширения). Также может создаваться карта загрузки `.map`.  
4. **Запуск программы** — выполнение созданного файла. Возможна отладка (debug) при помощи специальных инструментов.

Из-за специфики ассемблерного программирования чаще всего используются утилиты командной строки, хотя существуют и интегрированные среды разработки.

---

# Выполнение лабораторной работы

Создадим каталог для работы с программами на языке ассемблера NASM и перейдем в него.
Далее создадим текстовый файл с именем hello.asm, откроем этот файл с помощью текстового редактора gedit и введем нужную нам команду (см. рис. @fig-001).
Выполним компиляцию нашего текста программмы «Hello World». Объектный файл будет иметь имя hello.o

Соберём исполняемый файл из объектного файла с помощью компоновщика LD:
1. Убедимся, что объектный файл уже создан.
2. Выполним команду для компоновки объектного файла в исполняемый.
3. После выполнения этой команды будет создан исполняемый файл с именем main.

Далее запустим исполняемый файл (см. рис. @fig-001).

![Создание и компиляция программы на NASM](image/commands_1.png){#fig-001 width=70%}

# Выполнение самостоятельной работы

1. **Создание копии исходного файла**

   В каталоге `~/work/arch-pc/lab04` создадим копию файла `hello.asm` с именем `lab4.asm`:
   ```
   cp hello.asm lab4.asm
   ```

2. **Редактирование программы**

   Откроем файл `lab4.asm` в любом текстовом редакторе `gedit` и изменим строку вывода таким образом, чтобы вместо текста `Hello world!` на экран выводилась строка с моим именем и фамилией.

3. **Трансляция и компоновка программы**

   Оттранслируем исходный код `lab4.asm` в объектный файл, затем скомпонуем объектный файл и создадим исполняемый (см. рис. @fig-002, @fig-003).
   Проверим работу программы, запустив:
   ```
   ./lab4
   ```

4. **Копирование и загрузка файлов**

   Скопируем файлы `hello.asm` и `lab4.asm` в локальный репозиторий:
   ```
   cp hello.asm lab4.asm ~/work/study/2023-2024/"Архитектура компьютера"/arch-pc/labs/lab04/
   ```

   Затем выполним команды для загрузки изменений на GitHub:
   ```
   git add .
   git commit -m "Выполнена лабораторная работа 4"
   git push
   ```

![Копирование, редактирование и сборка программы](image/commands_2.png){#fig-002 width=70%}

![Загрузка файлов на GitHub](image/commands_3.png){#fig-003 width=70%}

# Выводы

В ходе выполнения лабораторной работы была освоена процедура компиляции и сборки программ, написанных на ассемблере NASM. Были изучены этапы трансляции исходного кода в объектный файл, компоновки с помощью утилиты LD, а также проверка работоспособности программы.
